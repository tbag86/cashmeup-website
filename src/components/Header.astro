---
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/pcp-claims/', label: 'PCP Claims' },
  { href: '/pcp-claims/how-it-works/', label: 'How It Works' },
  { href: '/about/', label: 'About' },
  { href: '/blog/', label: 'Blog' },
  { href: '/contact/', label: 'Contact' },
];

const currentPath = Astro.url.pathname;

// Determine active link â€” exact match takes priority, then startsWith but NOT a more-specific nav link match
function isActive(linkHref: string): boolean {
  if (linkHref === '/') return currentPath === '/';
  // Exact match
  if (currentPath === linkHref) return true;
  // Only use startsWith if NO more specific nav link matches exactly
  if (currentPath.startsWith(linkHref)) {
    // Check if a more-specific navLink matches exactly
    const moreSpecific = navLinks.some(l => l.href !== linkHref && l.href.startsWith(linkHref) && currentPath === l.href);
    if (moreSpecific) return false;
    return true;
  }
  return false;
}
---

<header class="sticky top-0 z-50 bg-white border-b border-slate-100 transition-shadow duration-300" id="main-header">
  <div class="container-wide">
    <nav class="flex items-center justify-between h-20 md:h-24">
      
      <!-- Logo -->
      <a href="/" class="flex items-center group" aria-label="Cash Me Up - Home">
        <img
          src="/logo-wide.png"
          alt="Cash Me Up"
          class="h-12 md:h-14 lg:h-16 w-auto transition-transform duration-200 group-hover:scale-105"
          width="320"
          height="80"
          loading="eager"
          decoding="async"
        />
      </a>

      <!-- Desktop Nav -->
      <ul class="hidden lg:flex items-center gap-1" role="list">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-150 ${
                isActive(link.href)
                  ? 'bg-[#2D6B2D] text-white'
                  : 'text-slate-600 hover:text-[#1B2A4A] hover:bg-slate-50'
              }`}
              aria-current={currentPath === link.href ? 'page' : undefined}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Desktop CTA -->
      <div class="hidden lg:flex items-center gap-3">
        <a href="/join/" class="btn-primary text-sm">
          <svg class="w-4 h-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          Join Free
        </a>
        <a href="/pcp-claims/" class="btn-secondary text-sm">
          Check PCP Claim
        </a>
      </div>

      <!-- Mobile hamburger -->
      <button
        id="mobile-menu-btn"
        class="lg:hidden p-2 rounded-lg text-slate-600 hover:text-[#1B2A4A] hover:bg-slate-50 transition-colors"
        aria-label="Open navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="hamburger-icon" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg id="close-icon" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </nav>
  </div>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    class="hidden lg:hidden border-t border-slate-100 bg-white"
    role="navigation"
    aria-label="Mobile navigation"
  >
    <div class="container-wide py-4">
      <ul class="flex flex-col gap-1" role="list">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`block px-4 py-3 rounded-lg text-sm font-medium transition-colors ${
                isActive(link.href)
                  ? 'bg-[#2D6B2D] text-white'
                  : 'text-slate-600 hover:text-[#1B2A4A] hover:bg-slate-50'
              }`}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <div class="flex flex-col gap-3 mt-4 pt-4 border-t border-slate-100">
        <a href="/pcp-claims/" class="btn-primary text-sm text-center">Check My PCP Claim</a>
        <a href="/join/" class="btn-secondary text-sm text-center">Join Free</a>
      </div>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById('main-header');
  const mobileBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  const closeIcon = document.getElementById('close-icon');

  // Sticky shadow on scroll
  window.addEventListener('scroll', () => {
    if (window.scrollY > 10) {
      header?.classList.add('nav-scrolled');
    } else {
      header?.classList.remove('nav-scrolled');
    }
  }, { passive: true });

  // Mobile menu toggle
  mobileBtn?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.contains('hidden');
    mobileMenu?.classList.toggle('hidden', !isOpen);
    hamburgerIcon?.classList.toggle('hidden', !isOpen);
    closeIcon?.classList.toggle('hidden', isOpen);
    mobileBtn.setAttribute('aria-expanded', String(!isOpen));
  });
</script>
